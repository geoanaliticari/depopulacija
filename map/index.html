<!doctype html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="initial-scale=1,user-scalable=no,maximum-scale=1,width=device-width">
  <meta name="mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <link rel="stylesheet" href="css/leaflet.css">
  <link rel="stylesheet" href="http://maxcdn.bootstrapcdn.com/font-awesome/4.6.1/css/font-awesome.min.css">
  <link rel="stylesheet" href="css/qgis2web.css">
  <link href="https://ajax.googleapis.com/ajax/libs/jqueryui/1.10.4/themes/smoothness/jquery-ui.min.css"
    rel="stylesheet" type="text/css" />
  <style>
    html,
    body,
    #map {
      width: 100%;
      height: 100%;
      padding: 0;
      margin: 0;
    }

    #basemapslidercontainer {
      position: absolute;
      top: 150px;
      right: 10px;
      z-index: 1000;
    }

    #basemapslider {
      font-size: 62.5%;
      margin: 14px;
      height: 125px;
      width: 7px;
    }

    .legend img {
      height: 500px;
    }
  </style>
  <title></title>
</head>

<body>
  <div id="map">
    <div id="basemapslidercontainer">
      <div id="basemapslider"></div>
    </div>
  </div>

  <script src="js/qgis2web_expressions.js"></script>
  <script src="js/leaflet.js"></script>
  <script src="js/leaflet.rotatedMarker.js"></script>
  <script src="js/leaflet.pattern.js"></script>
  <script src="js/leaflet-hash.js"></script>
  <script src="js/Autolinker.min.js"></script>
  <script src="js/rbush.min.js"></script>
  <script src="js/labelgun.min.js"></script>
  <script src="js/labels.js"></script>
  <script src="js/leaflet-measure.js"></script>
  <script src="data/DravnagranicaSrbije_1.js"></script>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.0/jquery.min.js"></script>
  <script src="https://ajax.googleapis.com/ajax/libs/jqueryui/1.10.4/jquery-ui.min.js"></script>
  <script>
    $(document).ready(function () {
      var layers = {
        "2": {
          "name": "Population change",
          "key": "2_population_change"
        },
        "3": {
          "name": "Population density",
          "key": "3_population_density"
        },
        "4": {
          "name": "Lot coverage change",
          "key": "4_lot_coverage_change"
        }
      }
      let layerName = '';

      let params = new URLSearchParams(window.location.search);
      if (params.has('l')) {
        layer = layers[params.get('l')];
        document.title = layer.name;
      }

      $("#basemapslider").slider({
        animate: true,
        value: 1,
        orientation: "vertical",
        min: 0,
        max: 1,
        step: 0.1,
        slide: function (event, ui) {
          mytile.setOpacity(ui.value);
        }
      });

      $('#basemapslider').mousedown(function () {
        map.dragging.disable();
      })

      $('#basemapslider').mouseup(function () {
        map.dragging.enable();
      })

      var map = L.map('map', {
        zoomControl: true,
        maxZoom: 12,
        minZoom: 1
      })
      .fitBounds([
        [41.8354051913, 18.9598079537], [46.1773125055, 23.1107030836]
      ]);

      map.attributionControl.addAttribution('<a href="https://github.com/tomchadwin/qgis2web" target="_blank">qgis2web</a>');

      var basemap0 = L.tileLayer('http://{s}.www.toolserver.org/tiles/bw-mapnik/{z}/{x}/{y}.png', {
        attribution: '&copy; <a href="http://openstreetmap.org">OpenStreetMap</a> contributors, <a href="http://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>',
        maxZoom: 12
      });
      basemap0.addTo(map);

      function pop_DravnagranicaSrbije_1(feature, layer) {
        var popupContent = '<table>\
                        <tr>\
                            <td colspan="2">' + (feature.properties['Drzava'] !== null ? Autolinker.link(String(feature.properties['Drzava'])) : '') + '</td>\
                        </tr>\
                        <tr>\
                            <td colspan="2">' + (feature.properties['Površina'] !== null ? Autolinker.link(String(feature.properties['Površina'])) : '') + '</td>\
                        </tr>\
                    </table>';
        layer.bindPopup(popupContent, { maxHeight: 400 });
      }

      function style_DravnagranicaSrbije_1_0() {
        return {
          pane: 'pane_DravnagranicaSrbije_1',
          opacity: 1,
          color: 'rgba(0,0,0,1.0)',
          dashArray: '',
          lineCap: 'square',
          lineJoin: 'bevel',
          weight: 1.0,
          fillOpacity: 0,
        }
      }
      map.createPane('pane_DravnagranicaSrbije_1');
      map.getPane('pane_DravnagranicaSrbije_1').style.zIndex = 401;
      map.getPane('pane_DravnagranicaSrbije_1').style['mix-blend-mode'] = 'normal';
      var layer_DravnagranicaSrbije_1 = new L.geoJson(json_DravnagranicaSrbije_1, {
        attribution: '<a href=""></a>',
        pane: 'pane_DravnagranicaSrbije_1',
        onEachFeature: pop_DravnagranicaSrbije_1,
        style: style_DravnagranicaSrbije_1_0,
      });

      var mytile = L.tileLayer(`tiles/${layer.key}/{z}/{x}/{y}.png`, {
        maxZoom: 12,
        tms: false,
        attribution: 'Generated by QTiles'
      }).addTo(map);

      map.addLayer(layer_DravnagranicaSrbije_1);
      var baseMaps = {};

      L.control.layers(baseMaps, {
        '<img src="legend/DravnagranicaSrbije_1.png" /> Državna granica Srbije': layer_DravnagranicaSrbije_1,
        "Indeks promene": mytile
      }).addTo(map);

      // LEGEND
      var legend = L.control({ position: 'bottomleft' });
      legend.onAdd = function (map) {
        var div = L.DomUtil.create('div', 'info legend');
        div.innerHTML = `<h4>${layer.name}</h4><img src="legend/${layer.key}.jpg" />`;
        return div;
      };

      legend.addTo(map);
    })
  </script>
</body>

</html>